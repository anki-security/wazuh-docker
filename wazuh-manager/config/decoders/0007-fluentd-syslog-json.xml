<!--
  Custom decoder for Fluentd syslog-wrapped JSON
  
  Input format from remote_syslog plugin:
  <134>Oct 11 00:42:12 wazuh-fluentd fluentd: {"log_source":"mikrotik","full_message":"..."}
  
  This decoder:
  1. Matches syslog format from Fluentd
  2. Extracts the JSON payload
  3. Decodes the JSON into fields
-->

<decoder name="fluentd-syslog-json">
  <prematch>fluentd: {</prematch>
  <regex offset="after_prematch">^(\S+.*})</regex>
  <order>json_data</order>
</decoder>

<decoder name="fluentd-json-fields">
  <parent>fluentd-syslog-json</parent>
  <type>json</type>
  <plugin_decoder>JSON_Decoder</plugin_decoder>
</decoder>
