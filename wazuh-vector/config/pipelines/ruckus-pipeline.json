{
  "description": "Ruckus Wireless Controller processing pipeline",
  "processors": [
    {
      "grok": {
        "field": "message",
        "patterns": [
          "%{SYSLOG5424PRI:syslog_pri}%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:device_hostname} %{DATA:process}(\\[%{NUMBER:pid}\\])?: \\[%{DATA:event_timestamp}\\]\\[%{WORD:log_level}\\]\\[%{DATA:component}\\]\\[%{WORD:category}\\]\\[%{GREEDYDATA:ruckus_message}\\]",
          "%{SYSLOG5424PRI:syslog_pri}%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:device_hostname} %{DATA:process}(\\[%{NUMBER:pid}\\])?: %{GREEDYDATA:ruckus_message}"
        ],
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "kv": {
        "field": "ruckus_message",
        "field_split": ",",
        "value_split": "=",
        "target_field": "ruckus",
        "trim_key": "\"",
        "trim_value": "\"",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "ruckus.apMac",
        "target_field": "observer.mac",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "ruckus.apName",
        "target_field": "observer.name",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "ruckus.apIpAddress",
        "target_field": "observer.ip",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "ruckus.clientMac",
        "target_field": "client.mac",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "ruckus.ueMac",
        "target_field": "client.mac",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "ruckus.clientIP",
        "target_field": "client.ip",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "ruckus.ueIp",
        "target_field": "client.ip",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "ruckus.ssid",
        "target_field": "network.name",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "ruckus.vlan",
        "target_field": "network.vlan.id",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "ruckus.reason",
        "target_field": "event.reason",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "script": {
        "lang": "painless",
        "source": "if (ctx.ruckus_message != null) { String msg = ctx.ruckus_message.toLowerCase(); if (msg.contains('connect') || msg.contains('association') || msg.contains('join')) { ctx.event = ['action': 'connect', 'category': ['network'], 'type': ['connection', 'start']]; } else if (msg.contains('disconnect') || msg.contains('disassociation') || msg.contains('leave')) { ctx.event = ['action': 'disconnect', 'category': ['network'], 'type': ['connection', 'end']]; } else if (msg.contains('auth')) { ctx.event = ['action': 'authenticate', 'category': ['authentication'], 'type': ['start']]; } else if (msg.contains('roam')) { ctx.event = ['action': 'roam', 'category': ['network'], 'type': ['change']]; } }",
        "ignore_failure": true
      }
    },
    {
      "set": {
        "field": "event.kind",
        "value": "event",
        "override": false
      }
    },
    {
      "set": {
        "field": "observer.type",
        "value": "wireless"
      }
    },
    {
      "set": {
        "field": "observer.vendor",
        "value": "ruckus"
      }
    },
    {
      "date": {
        "field": "syslog_timestamp",
        "target_field": "@timestamp",
        "formats": [
          "MMM dd HH:mm:ss",
          "MMM  d HH:mm:ss",
          "ISO8601"
        ],
        "ignore_failure": true
      }
    },
    {
      "remove": {
        "field": ["ruckus_message", "syslog_timestamp", "syslog_pri"],
        "ignore_missing": true,
        "ignore_failure": true
      }
    }
  ]
}
