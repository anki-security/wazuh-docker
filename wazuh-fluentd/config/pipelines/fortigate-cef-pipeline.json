{
  "description": "Fortigate CEF (Common Event Format) Parsing Pipeline",
  "processors": [
    {
      "grok": {
        "field": "message",
        "patterns": [
          "^CEF:%{INT:cef.version}\\|%{DATA:observer.vendor}\\|%{DATA:observer.product}\\|%{DATA:observer.version}\\|%{DATA:event.code}\\|%{DATA:event.action}\\|%{INT:event.severity}\\|%{GREEDYDATA:cef.extensions}$"
        ],
        "ignore_failure": true
      }
    },
    {
      "kv": {
        "field": "cef.extensions",
        "field_split": " ",
        "value_split": "=",
        "target_field": "cef.ext",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "cef.ext.src",
        "target_field": "source.ip",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "cef.ext.dst",
        "target_field": "destination.ip",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "cef.ext.spt",
        "target_field": "source.port",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "cef.ext.dpt",
        "target_field": "destination.port",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "cef.ext.proto",
        "target_field": "network.transport",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "convert": {
        "field": "source.port",
        "type": "long",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "convert": {
        "field": "destination.port",
        "type": "long",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "lowercase": {
        "field": "network.transport",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "geoip": {
        "field": "source.ip",
        "target_field": "source.geo",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "geoip": {
        "field": "destination.ip",
        "target_field": "destination.geo",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "set": {
        "field": "observer.type",
        "value": "firewall"
      }
    },
    {
      "set": {
        "field": "ecs.version",
        "value": "8.12.0"
      }
    },
    {
      "append": {
        "field": "event.category",
        "value": ["network"],
        "allow_duplicates": false
      }
    }
  ],
  "on_failure": [
    {
      "set": {
        "field": "error.message",
        "value": "{{ _ingest.on_failure_message }}"
      }
    },
    {
      "set": {
        "field": "event.kind",
        "value": "pipeline_error"
      }
    }
  ]
}
