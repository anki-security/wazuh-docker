{
  "description": "sFlow processing pipeline",
  "processors": [
    {
      "set": {
        "field": "event.kind",
        "value": "event"
      }
    },
    {
      "set": {
        "field": "event.category",
        "value": ["network"]
      }
    },
    {
      "set": {
        "field": "event.type",
        "value": ["connection", "protocol"]
      }
    },
    {
      "rename": {
        "field": "sflow.src_ip",
        "target_field": "source.ip",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "sflow.dst_ip",
        "target_field": "destination.ip",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "sflow.src_port",
        "target_field": "source.port",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "sflow.dst_port",
        "target_field": "destination.port",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "sflow.protocol",
        "target_field": "network.iana_number",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "sflow.frame_length",
        "target_field": "network.bytes",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "sflow.src_mac",
        "target_field": "source.mac",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "sflow.dst_mac",
        "target_field": "destination.mac",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "sflow.vlan",
        "target_field": "network.vlan.id",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "sflow.input_interface",
        "target_field": "observer.ingress.interface.name",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "sflow.output_interface",
        "target_field": "observer.egress.interface.name",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "script": {
        "lang": "painless",
        "source": "def protocols = ['1': 'icmp', '6': 'tcp', '17': 'udp', '47': 'gre', '50': 'esp', '51': 'ah', '58': 'ipv6-icmp']; if (ctx.network?.iana_number != null) { String proto = protocols.get(ctx.network.iana_number.toString()); if (proto != null) { ctx.network.transport = proto; } }",
        "ignore_failure": true
      }
    },
    {
      "convert": {
        "field": "source.port",
        "type": "long",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "convert": {
        "field": "destination.port",
        "type": "long",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "convert": {
        "field": "network.bytes",
        "type": "long",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "convert": {
        "field": "network.vlan.id",
        "type": "long",
        "ignore_missing": true,
        "ignore_failure": true
      }
    },
    {
      "set": {
        "field": "observer.type",
        "value": "switch"
      }
    }
  ]
}
